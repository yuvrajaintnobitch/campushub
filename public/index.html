<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusHub - College Club & Event Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{--primary:#6C5CE7;--primary-light:#A29BFE;--secondary:#00CEC9;--accent:#FD79A8;--success:#00B894;--warning:#FDCB6E;--danger:#D63031;--dark:#0A0A1A;--dark-card:#12122A;--dark-lighter:#1A1A3E;--dark-border:#2D2D5E;--text-primary:#FFF;--text-secondary:#B0B0D0;--text-muted:#6C6C9E;--gradient-primary:linear-gradient(135deg,#6C5CE7,#A29BFE);--gradient-accent:linear-gradient(135deg,#FD79A8,#E84393);--gradient-success:linear-gradient(135deg,#00B894,#55EFC4);--shadow:0 4px 20px rgba(0,0,0,0.3);--shadow-hover:0 8px 40px rgba(108,92,231,0.3);--radius:16px;--radius-sm:10px;--radius-full:50px}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:var(--dark);color:var(--text-primary);overflow-x:hidden;min-height:100vh}a{text-decoration:none;color:inherit}button{cursor:pointer;border:none;font-family:inherit}input,textarea,select{font-family:inherit;outline:none;border:none}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--dark)}::-webkit-scrollbar-thumb{background:var(--primary);border-radius:3px}

        /* LANDING PAGE */
        .landing-page{min-height:100vh;position:relative;overflow:hidden}
        .landing-page::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(ellipse at 30% 20%,rgba(108,92,231,0.12) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(253,121,168,0.08) 0%,transparent 50%);animation:float 20s ease-in-out infinite}
        @keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(-20px,-20px)}}
        .landing-nav{display:flex;align-items:center;justify-content:space-between;padding:20px 60px;position:relative;z-index:10}
        .landing-logo{font-size:24px;font-weight:800;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .landing-nav-btns{display:flex;gap:12px}
        .btn-ghost{padding:10px 24px;border-radius:var(--radius-full);color:var(--text-secondary);font-weight:600;font-size:14px;transition:all .2s;background:transparent}
        .btn-ghost:hover{color:var(--text-primary);background:var(--dark-lighter)}
        .btn-landing{padding:10px 24px;border-radius:var(--radius-full);background:var(--gradient-primary);color:#fff;font-weight:600;font-size:14px;transition:all .3s}
        .btn-landing:hover{transform:translateY(-2px);box-shadow:var(--shadow-hover)}
        .landing-hero{display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 80px);padding:40px 60px;position:relative;z-index:10}
        .hero-content{max-width:600px;text-align:center}
        .hero-badge{display:inline-block;padding:6px 16px;border-radius:var(--radius-full);background:rgba(108,92,231,0.15);color:var(--primary-light);font-size:13px;font-weight:600;margin-bottom:24px}
        .hero-title{font-size:52px;font-weight:900;line-height:1.1;margin-bottom:20px}
        .hero-title .gradient{background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .hero-subtitle{font-size:18px;color:var(--text-secondary);line-height:1.6;margin-bottom:36px}
        .hero-btns{display:flex;gap:16px;justify-content:center}
        .btn-hero-primary{padding:16px 36px;border-radius:var(--radius-full);background:var(--gradient-primary);color:#fff;font-size:16px;font-weight:700;transition:all .3s}
        .btn-hero-primary:hover{transform:translateY(-3px);box-shadow:var(--shadow-hover)}
        .btn-hero-secondary{padding:16px 36px;border-radius:var(--radius-full);background:var(--dark-card);border:1px solid var(--dark-border);color:var(--text-secondary);font-size:16px;font-weight:600;transition:all .3s}
        .btn-hero-secondary:hover{border-color:var(--primary);color:var(--text-primary)}
        .landing-features{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;padding:60px;position:relative;z-index:10;max-width:1100px;margin:0 auto}
        .feature-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);padding:32px;text-align:center;transition:all .3s}
        .feature-card:hover{transform:translateY(-6px);box-shadow:var(--shadow-hover);border-color:var(--primary)}
        .feature-icon{font-size:40px;margin-bottom:16px}
        .feature-card h3{font-size:18px;font-weight:700;margin-bottom:8px}
        .feature-card p{font-size:14px;color:var(--text-secondary);line-height:1.5}
        .landing-stats{display:flex;justify-content:center;gap:48px;padding:40px;position:relative;z-index:10}
        .landing-stat{text-align:center}
        .landing-stat .stat-num{font-size:36px;font-weight:800;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .landing-stat .stat-txt{font-size:14px;color:var(--text-muted);margin-top:4px}

        /* AUTH */
        .auth-container{min-height:100vh;display:none;align-items:center;justify-content:center;padding:20px;background:var(--dark);position:relative}
        .auth-container.active{display:flex}
        .auth-container::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(ellipse at 30% 20%,rgba(108,92,231,0.15) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(253,121,168,0.1) 0%,transparent 50%);animation:float 20s ease-in-out infinite}
        .auth-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);padding:40px;width:100%;max-width:460px;position:relative;z-index:1;box-shadow:var(--shadow)}
        .auth-card h1{font-size:28px;font-weight:800;text-align:center;margin-bottom:8px;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .auth-card .subtitle{text-align:center;color:var(--text-secondary);margin-bottom:32px;font-size:14px}
        .form-group{margin-bottom:20px}.form-group label{display:block;font-size:13px;font-weight:600;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:12px 16px;background:var(--dark-lighter);border:1px solid var(--dark-border);border-radius:var(--radius-sm);color:var(--text-primary);font-size:15px;transition:all .3s}
        .form-group textarea{resize:vertical;min-height:80px}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(108,92,231,0.2)}
        .form-group select option{background:var(--dark-card)}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .btn-primary{width:100%;padding:14px;background:var(--gradient-primary);color:#fff;font-size:16px;font-weight:700;border-radius:var(--radius-sm);transition:all .3s;margin-top:8px}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-hover)}.btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none}
        .auth-toggle{text-align:center;margin-top:20px;color:var(--text-secondary);font-size:14px}.auth-toggle a{color:var(--primary-light);font-weight:600;cursor:pointer}
        .error-msg{background:rgba(214,48,49,0.1);border:1px solid rgba(214,48,49,0.3);color:#FF6B6B;padding:10px 14px;border-radius:var(--radius-sm);font-size:13px;margin-bottom:16px;display:none}.error-msg.show{display:block}
        .success-msg{background:rgba(0,184,148,0.1);border:1px solid rgba(0,184,148,0.3);color:#55EFC4;padding:10px 14px;border-radius:var(--radius-sm);font-size:13px;margin-bottom:16px;display:none}.success-msg.show{display:block}
        .role-select{display:flex;gap:10px;margin-bottom:20px}.role-option{flex:1;padding:12px;background:var(--dark-lighter);border:2px solid var(--dark-border);border-radius:var(--radius-sm);text-align:center;cursor:pointer;transition:all .3s;font-size:13px;font-weight:600}
        .role-option.active{border-color:var(--primary);background:rgba(108,92,231,0.15)}.role-option .role-icon{font-size:24px;display:block;margin-bottom:4px}
        .otp-section{display:none;margin-bottom:20px}.otp-section.show{display:block}
        .otp-input-row{display:flex;gap:8px}.otp-input-row input{flex:1}.otp-input-row button{padding:12px 20px;background:var(--gradient-primary);color:#fff;border-radius:var(--radius-sm);font-weight:600;font-size:13px;white-space:nowrap}
        .otp-status{font-size:12px;margin-top:8px;font-weight:600}
        .otp-status.verified{color:var(--success)}.otp-status.pending{color:var(--warning)}

        /* APP LAYOUT */
        .app-container{display:none}.app-container.active{display:flex;min-height:100vh}
        .sidebar{width:260px;background:var(--dark-card);border-right:1px solid var(--dark-border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100;transition:transform .3s}
        .sidebar-header{padding:24px 20px;border-bottom:1px solid var(--dark-border)}
        .sidebar-header h2{font-size:22px;font-weight:800;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .sidebar-header .user-role{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin-top:2px}
        .sidebar-header .admin-club-name{font-size:12px;color:var(--primary-light);margin-top:4px;font-weight:600}
        .sidebar-nav{flex:1;padding:16px 12px;overflow-y:auto}
        .nav-section-title{font-size:10px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;padding:12px 12px 6px}
        .nav-item{display:flex;align-items:center;gap:12px;padding:11px 14px;border-radius:var(--radius-sm);color:var(--text-secondary);font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;margin-bottom:2px;position:relative}
        .nav-item:hover{background:var(--dark-lighter);color:var(--text-primary)}.nav-item.active{background:rgba(108,92,231,0.15);color:var(--primary-light)}
        .nav-item i{width:20px;text-align:center;font-size:15px}
        .nav-badge{position:absolute;right:12px;background:var(--danger);color:#fff;font-size:10px;font-weight:700;padding:2px 7px;border-radius:10px;min-width:18px;text-align:center}
        .sidebar-footer{padding:16px;border-top:1px solid var(--dark-border)}
        .user-profile-mini{display:flex;align-items:center;gap:12px;padding:10px;border-radius:var(--radius-sm);cursor:pointer;transition:background .2s}.user-profile-mini:hover{background:var(--dark-lighter)}
        .user-avatar{width:38px;height:38px;border-radius:50%;background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:15px}
        .user-info .user-name{font-size:14px;font-weight:600}.user-info .user-email{font-size:11px;color:var(--text-muted)}

        .main-content{flex:1;margin-left:260px;min-height:100vh}
        .top-bar{display:flex;align-items:center;justify-content:space-between;padding:16px 32px;background:var(--dark-card);border-bottom:1px solid var(--dark-border);position:sticky;top:0;z-index:50}
        .top-bar-left{display:flex;align-items:center;gap:16px}.menu-toggle{display:none;background:none;color:var(--text-primary);font-size:20px;padding:8px}
        .page-title{font-size:20px;font-weight:700}.top-bar-right{display:flex;align-items:center;gap:16px}
        .search-bar{display:flex;align-items:center;background:var(--dark-lighter);border:1px solid var(--dark-border);border-radius:var(--radius-full);padding:8px 16px;width:280px}
        .search-bar i{color:var(--text-muted);margin-right:8px;font-size:14px}.search-bar input{background:none;color:var(--text-primary);font-size:13px;width:100%}
        .icon-btn{width:40px;height:40px;border-radius:50%;background:var(--dark-lighter);color:var(--text-secondary);display:flex;align-items:center;justify-content:center;font-size:16px;transition:all .2s;position:relative}
        .icon-btn:hover{background:var(--dark-border);color:var(--text-primary)}
        .icon-btn .badge{position:absolute;top:-2px;right:-2px;background:var(--danger);color:#fff;font-size:9px;font-weight:700;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center}
        .btn-logout{padding:8px 16px;background:rgba(214,48,49,0.15);color:#FF6B6B;border-radius:var(--radius-full);font-size:13px;font-weight:600;transition:all .2s}.btn-logout:hover{background:rgba(214,48,49,0.3)}
        .page-content{padding:32px}.page{display:none}.page.active{display:block}

        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:32px}
        .stat-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);padding:24px;transition:all .3s}.stat-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-hover)}
        .stat-card .stat-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:16px}
        .stat-card .stat-value{font-size:28px;font-weight:800}.stat-card .stat-label{font-size:13px;color:var(--text-secondary);margin-top:4px}

        .clubs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
        .club-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);overflow:hidden;transition:all .3s;cursor:pointer}
        .club-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-hover);border-color:var(--primary)}
        .club-card-banner{height:80px;display:flex;align-items:center;justify-content:center;font-size:36px}
        .club-card-body{padding:20px}.club-card-body h3{font-size:18px;font-weight:700;margin-bottom:8px}
        .club-card-body p{font-size:13px;color:var(--text-secondary);line-height:1.5;margin-bottom:16px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .club-card-meta{display:flex;align-items:center;justify-content:space-between}.club-card-meta .members{font-size:12px;color:var(--text-muted)}.club-card-meta .rating{font-size:12px;color:var(--warning)}
        .badge-category{display:inline-block;padding:4px 10px;border-radius:var(--radius-full);font-size:11px;font-weight:600;margin-bottom:12px}
        .club-card-actions{padding:12px 20px;border-top:1px solid var(--dark-border);display:flex;gap:8px}
        .btn-sm{padding:8px 16px;border-radius:var(--radius-full);font-size:12px;font-weight:600;transition:all .2s;flex:1;text-align:center}
        .btn-join{background:var(--gradient-primary);color:#fff}.btn-join:hover{box-shadow:var(--shadow-hover)}
        .btn-joined{background:rgba(0,184,148,0.15);color:var(--success)}.btn-pending{background:rgba(253,203,110,0.15);color:var(--warning)}
        .btn-view{background:var(--dark-lighter);color:var(--text-secondary)}.btn-view:hover{color:var(--text-primary)}
        .btn-leave{background:rgba(214,48,49,0.15);color:#FF6B6B}

        .events-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px}
        .event-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);overflow:hidden;transition:all .3s;cursor:pointer}
        .event-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-hover)}
        .event-card-banner{height:60px;display:flex;align-items:center;padding:0 20px;gap:12px}
        .event-card-banner .event-icon{font-size:28px}.event-card-banner .event-club{font-size:12px;color:rgba(255,255,255,0.8);font-weight:600}
        .event-card-body{padding:20px}.event-card-body h3{font-size:17px;font-weight:700;margin-bottom:12px}
        .event-detail{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text-secondary);margin-bottom:6px}.event-detail i{width:16px;color:var(--primary-light)}
        .event-card-footer{padding:12px 20px;border-top:1px solid var(--dark-border);display:flex;align-items:center;justify-content:space-between}
        .event-spots{font-size:12px;color:var(--text-muted)}.event-price{font-size:13px;font-weight:700;color:var(--success)}
        .event-reg-status{font-size:11px;padding:4px 10px;border-radius:var(--radius-full);font-weight:600}
        .event-reg-status.registered{background:rgba(0,184,148,0.15);color:var(--success)}.event-reg-status.attended{background:rgba(108,92,231,0.15);color:var(--primary-light)}

        .notification-list{display:flex;flex-direction:column;gap:8px}
        .notification-item{display:flex;align-items:flex-start;gap:14px;padding:16px;background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius-sm);transition:all .2s;cursor:pointer}
        .notification-item.unread{border-left:3px solid var(--primary);background:rgba(108,92,231,0.05)}
        .notification-item .notif-icon{font-size:24px;flex-shrink:0}.notification-item .notif-content{flex:1}
        .notification-item .notif-title{font-size:14px;font-weight:600;margin-bottom:4px}
        .notification-item .notif-msg{font-size:13px;color:var(--text-secondary);margin-bottom:4px}.notification-item .notif-time{font-size:11px;color:var(--text-muted)}

        .chat-container{display:grid;grid-template-columns:280px 1fr;height:calc(100vh - 140px);background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);overflow:hidden}
        .chat-channels{border-right:1px solid var(--dark-border);overflow-y:auto}.chat-channels-header{padding:20px;font-size:16px;font-weight:700;border-bottom:1px solid var(--dark-border)}
        .channel-item{display:flex;align-items:center;gap:12px;padding:14px 20px;cursor:pointer;transition:background .2s;border-bottom:1px solid var(--dark-border)}
        .channel-item:hover,.channel-item.active{background:rgba(108,92,231,0.1)}
        .channel-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}
        .channel-info{flex:1;overflow:hidden}.channel-name{font-size:14px;font-weight:600}.channel-last-msg{font-size:12px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .chat-main{display:flex;flex-direction:column}.chat-header{padding:16px 24px;border-bottom:1px solid var(--dark-border);font-size:16px;font-weight:700}
        .chat-messages{flex:1;overflow-y:auto;padding:20px 24px;display:flex;flex-direction:column;gap:12px}
        .chat-msg{display:flex;gap:10px;max-width:70%}.chat-msg.own{margin-left:auto;flex-direction:row-reverse}
        .chat-msg-avatar{width:32px;height:32px;border-radius:50%;background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
        .chat-msg-bubble{background:var(--dark-lighter);padding:10px 14px;border-radius:14px;border-top-left-radius:4px}
        .chat-msg.own .chat-msg-bubble{background:var(--primary);border-top-left-radius:14px;border-top-right-radius:4px}
        .chat-msg-sender{font-size:11px;font-weight:600;color:var(--primary-light);margin-bottom:2px}.chat-msg.own .chat-msg-sender{color:rgba(255,255,255,0.7)}
        .chat-msg-text{font-size:14px;line-height:1.4}.chat-msg-time{font-size:10px;color:var(--text-muted);margin-top:4px}
        .chat-input-area{padding:16px 24px;border-top:1px solid var(--dark-border);display:flex;gap:12px;align-items:center}
        .chat-input{flex:1;padding:12px 18px;background:var(--dark-lighter);border:1px solid var(--dark-border);border-radius:var(--radius-full);color:var(--text-primary);font-size:14px}.chat-input:focus{border-color:var(--primary)}
        .chat-send-btn{width:44px;height:44px;border-radius:50%;background:var(--gradient-primary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;transition:transform .2s}.chat-send-btn:hover{transform:scale(1.05)}
        .chat-no-channel{flex:1;display:flex;align-items:center;justify-content:center;color:var(--text-muted);font-size:15px}

        .admin-section{display:none}.admin-section.show{display:block}
        .pending-list{display:flex;flex-direction:column;gap:12px}
        .pending-item{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius-sm)}
        .pending-item .pending-info{display:flex;align-items:center;gap:12px}
        .pending-item .pending-avatar{width:40px;height:40px;border-radius:50%;background:var(--gradient-accent);display:flex;align-items:center;justify-content:center;font-weight:700}
        .pending-item .pending-name{font-weight:600}.pending-item .pending-detail{font-size:12px;color:var(--text-muted)}
        .pending-actions{display:flex;gap:8px}
        .btn-approve{padding:6px 14px;background:var(--gradient-success);color:#fff;border-radius:var(--radius-full);font-size:12px;font-weight:600}
        .btn-reject{padding:6px 14px;background:rgba(214,48,49,0.2);color:#FF6B6B;border-radius:var(--radius-full);font-size:12px;font-weight:600}

        .calendar-container{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);overflow:hidden;margin-bottom:24px}
        .calendar-header-bar{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--dark-border)}.calendar-header-bar h3{font-size:18px;font-weight:700}
        .calendar-nav{display:flex;gap:8px}.calendar-nav button{width:36px;height:36px;border-radius:50%;background:var(--dark-lighter);color:var(--text-secondary);display:flex;align-items:center;justify-content:center;font-size:14px;transition:all .2s}.calendar-nav button:hover{background:var(--primary);color:#fff}
        .calendar-weekdays{display:grid;grid-template-columns:repeat(7,1fr);padding:12px 16px;border-bottom:1px solid var(--dark-border)}
        .calendar-weekdays span{text-align:center;font-size:11px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px}
        .calendar-days{display:grid;grid-template-columns:repeat(7,1fr);padding:8px 16px 16px;gap:4px}
        .calendar-day{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:10px;font-size:14px;font-weight:500;color:var(--text-secondary);cursor:pointer;transition:all .2s;position:relative;min-height:44px}
        .calendar-day:hover{background:var(--dark-lighter)}.calendar-day.today{background:rgba(108,92,231,0.2);color:var(--primary-light);font-weight:700}
        .calendar-day.has-event{color:var(--text-primary);font-weight:600}
        .calendar-day.has-event::after{content:'';position:absolute;bottom:6px;width:6px;height:6px;border-radius:50%;background:var(--primary)}
        .calendar-day.other-month{color:var(--text-muted);opacity:.4}.calendar-day.selected{background:var(--primary);color:#fff}.calendar-day.selected::after{background:#fff}
        .calendar-events-panel{padding:20px 24px;border-top:1px solid var(--dark-border)}
        .calendar-events-panel h4{font-size:14px;font-weight:700;margin-bottom:12px;color:var(--text-secondary)}
        .cal-event-item{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--dark-lighter);border-radius:var(--radius-sm);margin-bottom:8px}
        .cal-event-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}.cal-event-info{flex:1}.cal-event-title{font-size:13px;font-weight:600}.cal-event-time{font-size:11px;color:var(--text-muted)}

        .certificates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px}
        .cert-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);overflow:hidden;transition:all .3s}.cert-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-hover)}
        .cert-card-top{padding:24px;text-align:center;background:linear-gradient(135deg,rgba(108,92,231,0.15),rgba(253,121,168,0.1));border-bottom:1px solid var(--dark-border)}
        .cert-card-top .cert-icon{font-size:48px;margin-bottom:8px}.cert-card-top h3{font-size:16px;font-weight:700}.cert-card-top .cert-type{font-size:12px;color:var(--primary-light);font-weight:600;text-transform:uppercase;margin-top:4px}
        .cert-card-body{padding:20px}.cert-detail{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--dark-border);font-size:13px}.cert-detail:last-child{border-bottom:none}
        .cert-detail .cert-label{color:var(--text-muted)}.cert-detail .cert-value{font-weight:600}
        .cert-card-actions{padding:12px 20px;border-top:1px solid var(--dark-border);display:flex;gap:8px}
        .btn-download{flex:1;padding:10px;background:var(--gradient-primary);color:#fff;border-radius:var(--radius-full);font-size:13px;font-weight:600;text-align:center}
        .verify-box{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);padding:32px;text-align:center;margin-bottom:24px}
        .verify-box h3{margin-bottom:16px}.verify-input-group{display:flex;gap:12px;max-width:400px;margin:0 auto}
        .verify-result{margin-top:16px;padding:16px;border-radius:var(--radius-sm);display:none}.verify-result.show{display:block}
        .verify-result.valid{background:rgba(0,184,148,0.1);border:1px solid rgba(0,184,148,0.3);color:var(--success)}
        .verify-result.invalid{background:rgba(214,48,49,0.1);border:1px solid rgba(214,48,49,0.3);color:#FF6B6B}

        .create-event-section{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);padding:32px;margin-bottom:32px}
        .create-event-section h3{font-size:18px;font-weight:700;margin-bottom:20px}

        .admin-club-dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:32px}
        .admin-info-card{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);padding:24px}
        .admin-info-card h4{font-size:16px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px}
        .admin-member-item{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--dark-border);font-size:13px}
        .admin-member-item:last-child{border-bottom:none}
        .admin-member-avatar{width:30px;height:30px;border-radius:50%;background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700}

        .section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}.section-header h2{font-size:22px;font-weight:700}
        .filter-bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:20px}
        .filter-btn{padding:8px 16px;background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius-full);color:var(--text-secondary);font-size:13px;font-weight:500;transition:all .2s}
        .filter-btn.active,.filter-btn:hover{background:var(--primary);color:#fff;border-color:var(--primary)}

        .profile-header{display:flex;align-items:center;gap:24px;padding:32px;background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);margin-bottom:24px}
        .profile-avatar{width:80px;height:80px;border-radius:50%;background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:800}
        .profile-details h2{font-size:24px;font-weight:700}.profile-details .profile-email{color:var(--text-secondary);font-size:14px}
        .profile-details .profile-meta{display:flex;gap:16px;margin-top:8px;font-size:13px;color:var(--text-muted)}

        .empty-state{text-align:center;padding:60px 20px;color:var(--text-muted)}.empty-state .empty-icon{font-size:48px;margin-bottom:16px}.empty-state h3{font-size:18px;color:var(--text-secondary);margin-bottom:8px}.empty-state p{font-size:14px}
        .loading{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--text-muted)}
        .spinner{width:32px;height:32px;border:3px solid var(--dark-border);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite;margin-right:12px}@keyframes spin{to{transform:rotate(360deg)}}

        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-overlay.active{display:flex}
        .modal{background:var(--dark-card);border:1px solid var(--dark-border);border-radius:var(--radius);padding:32px;width:100%;max-width:520px;max-height:85vh;overflow-y:auto}
        .modal h2{font-size:20px;font-weight:700;margin-bottom:20px}.modal-close{float:right;background:none;color:var(--text-muted);font-size:20px;cursor:pointer}

        .toast-container{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:8px}
        .toast{padding:14px 20px;border-radius:var(--radius-sm);font-size:14px;font-weight:500;box-shadow:var(--shadow);animation:slideIn .3s ease;max-width:360px}
        .toast.success{background:#00B894;color:#fff}.toast.error{background:#D63031;color:#fff}.toast.info{background:#6C5CE7;color:#fff}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}

        @media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.main-content{margin-left:0}.menu-toggle{display:block}.search-bar{width:180px}.page-content{padding:20px}.stats-grid{grid-template-columns:repeat(2,1fr)}.clubs-grid,.events-grid,.certificates-grid{grid-template-columns:1fr}.chat-container{grid-template-columns:1fr}.chat-channels{display:none}.profile-header{flex-direction:column;text-align:center}.form-row{grid-template-columns:1fr}.calendar-days .calendar-day{min-height:36px;font-size:12px}.landing-hero{padding:40px 20px}.hero-title{font-size:32px}.landing-nav{padding:20px}.landing-features{padding:20px}.landing-stats{flex-wrap:wrap;gap:24px}.admin-club-dashboard{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div class="toast-container" id="toastContainer"></div>

<!-- LANDING PAGE -->
<div class="landing-page" id="landingPage">
    <nav class="landing-nav">
        <div class="landing-logo">üéì CampusHub</div>
        <div class="landing-nav-btns">
            <button class="btn-ghost" onclick="showAuthPage('login')">Sign In</button>
            <button class="btn-landing" onclick="showAuthPage('register')">Get Started</button>
        </div>
    </nav>
    <div class="landing-hero">
        <div class="hero-content">
            <span class="hero-badge">üöÄ Your Campus, Connected</span>
            <h1 class="hero-title">Manage Clubs & Events <span class="gradient">Like a Pro</span></h1>
            <p class="hero-subtitle">Join clubs, register for events, chat with members, earn certificates ‚Äî all in one place. Built for students, by students.</p>
            <div class="hero-btns">
                <button class="btn-hero-primary" onclick="showAuthPage('register')">Create Account</button>
                <button class="btn-hero-secondary" onclick="showAuthPage('login')">Sign In</button>
            </div>
        </div>
    </div>
    <div class="landing-stats" id="landingStats">
        <div class="landing-stat"><div class="stat-num" id="lsClubs">12</div><div class="stat-txt">Active Clubs</div></div>
        <div class="landing-stat"><div class="stat-num" id="lsEvents">50+</div><div class="stat-txt">Events Hosted</div></div>
        <div class="landing-stat"><div class="stat-num" id="lsStudents">1000+</div><div class="stat-txt">Students</div></div>
        <div class="landing-stat"><div class="stat-num" id="lsCerts">500+</div><div class="stat-txt">Certificates</div></div>
    </div>
    <div class="landing-features">
        <div class="feature-card"><div class="feature-icon">üèõÔ∏è</div><h3>Join Clubs</h3><p>Explore and join clubs that match your interests. From coding to music, we have it all.</p></div>
        <div class="feature-card"><div class="feature-icon">üìÖ</div><h3>Events & Calendar</h3><p>Register for events, track them on your personal calendar, never miss out.</p></div>
        <div class="feature-card"><div class="feature-icon">üí¨</div><h3>Club Chat</h3><p>Chat with club members in real-time. Stay connected with your community.</p></div>
        <div class="feature-card"><div class="feature-icon">üèÜ</div><h3>Certificates</h3><p>Earn verifiable certificates for events you attend. Build your portfolio.</p></div>
    </div>
</div>

<!-- AUTH PAGE -->
<div class="auth-container" id="authPage">
    <div class="auth-card">
        <div id="loginForm">
            <h1>üéì CampusHub</h1><p class="subtitle">Welcome back!</p>
            <div class="error-msg" id="loginError"></div>
            <div class="form-group"><label>Email</label><input type="email" id="loginEmail" placeholder="you@college.edu"></div>
            <div class="form-group"><label>Password</label><input type="password" id="loginPassword" placeholder="Enter password" onkeydown="if(event.key==='Enter')handleLogin()"></div>
            <button class="btn-primary" id="loginBtn" onclick="handleLogin()">Sign In</button>
            <p class="auth-toggle">Don't have an account? <a onclick="showAuthPage('register')">Sign Up</a></p>
            <p class="auth-toggle" style="margin-top:10px"><a onclick="showLanding()" style="color:var(--text-muted)">‚Üê Back to Home</a></p>
        </div>
        <div id="registerForm" style="display:none">
            <h1>üéì CampusHub</h1><p class="subtitle">Create your account</p>
            <div class="error-msg" id="registerError"></div>
            <div class="success-msg" id="registerSuccess"></div>
            <div class="form-group"><label>Full Name</label><input type="text" id="regName" placeholder="Your full name"></div>
            <div class="form-group"><label>Email</label>
                <div class="otp-input-row"><input type="email" id="regEmail" placeholder="you@college.edu"><button onclick="sendOTP()" id="sendOtpBtn">Send OTP</button></div>
                <div class="otp-status" id="otpStatus"></div>
            </div>
            <div class="otp-section" id="otpSection">
                <div class="form-group"><label>Verification Code</label>
                    <div class="otp-input-row"><input type="text" id="otpInput" placeholder="Enter 6-digit code" maxlength="6"><button onclick="verifyOTP()">Verify</button></div>
                </div>
            </div>
            <div class="form-group"><label>Password</label><input type="password" id="regPassword" placeholder="Min 6 characters"></div>
            <div class="form-row">
                <div class="form-group"><label>Department</label><select id="regDept"><option value="">Select</option><option>CSE</option><option>ECE</option><option>EEE</option><option>ME</option><option>CE</option><option>IT</option><option>MBA</option><option>Other</option></select></div>
                <div class="form-group"><label>Year</label><select id="regYear"><option value="">Select</option><option value="1">1st Year</option><option value="2">2nd Year</option><option value="3">3rd Year</option><option value="4">4th Year</option></select></div>
            </div>
            <div class="form-group"><label>Register As</label>
                <div class="role-select">
                    <div class="role-option active" onclick="selectRole('student',this)"><span class="role-icon">üéì</span> Student</div>
                    <div class="role-option" onclick="selectRole('admin',this)"><span class="role-icon">‚öôÔ∏è</span> Club Admin</div>
                </div>
            </div>
            <input type="hidden" id="regRole" value="student">
            <input type="hidden" id="emailVerified" value="false">
            <div class="admin-section" id="clubSelectGroup">
                <div class="form-group"><label>Select Your Club</label><select id="regClub"><option value="">Loading...</option></select></div>
            </div>
            <button class="btn-primary" id="registerBtn" onclick="handleRegister()">Create Account</button>
            <p class="auth-toggle">Already have an account? <a onclick="showAuthPage('login')">Sign In</a></p>
            <p class="auth-toggle" style="margin-top:10px"><a onclick="showLanding()" style="color:var(--text-muted)">‚Üê Back to Home</a></p>
        </div>
    </div>
</div>

<!-- MAIN APP -->
<div class="app-container" id="appContainer">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header"><h2>üéì CampusHub</h2><div class="user-role" id="sidebarRole">Student Portal</div><div class="admin-club-name" id="sidebarClubName" style="display:none"></div></div>
        <nav class="sidebar-nav">
            <div class="nav-section-title">Main</div>
            <div class="nav-item active" onclick="navigateTo('dashboard')" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</div>
            <div class="nav-item" onclick="navigateTo('clubs')" data-page="clubs"><i class="fas fa-users-rectangle"></i> Clubs</div>
            <div class="nav-item" onclick="navigateTo('events')" data-page="events"><i class="fas fa-calendar-days"></i> Events</div>
            <div class="nav-item" onclick="navigateTo('calendar')" data-page="calendar"><i class="fas fa-calendar"></i> Calendar</div>
            <div class="nav-item" onclick="navigateTo('chat')" data-page="chat"><i class="fas fa-comments"></i> Chat</div>
            <div class="nav-item" onclick="navigateTo('certificates')" data-page="certificates"><i class="fas fa-award"></i> Certificates</div>
            <div class="nav-item" onclick="navigateTo('notifications')" data-page="notifications"><i class="fas fa-bell"></i> Notifications<span class="nav-badge" id="navNotifBadge" style="display:none">0</span></div>
            <div class="admin-section" id="adminNav"><div class="nav-section-title">Admin</div><div class="nav-item" onclick="navigateTo('admin')" data-page="admin"><i class="fas fa-shield-halved"></i> Admin Panel</div></div>
            <div class="nav-section-title">Account</div>
            <div class="nav-item" onclick="navigateTo('profile')" data-page="profile"><i class="fas fa-user"></i> Profile</div>
        </nav>
        <div class="sidebar-footer"><div class="user-profile-mini" onclick="navigateTo('profile')"><div class="user-avatar" id="sidebarAvatar">U</div><div class="user-info"><div class="user-name" id="sidebarName">User</div><div class="user-email" id="sidebarEmail">user@email.com</div></div></div></div>
    </aside>
    <div class="main-content">
        <div class="top-bar">
            <div class="top-bar-left"><button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button><h1 class="page-title" id="pageTitle">Dashboard</h1></div>
            <div class="top-bar-right"><div class="search-bar"><i class="fas fa-search"></i><input type="text" placeholder="Search..." id="globalSearch" onkeyup="handleGlobalSearch(event)"></div><button class="icon-btn" onclick="navigateTo('notifications')"><i class="fas fa-bell"></i><span class="badge" id="topNotifBadge" style="display:none">0</span></button><button class="btn-logout" onclick="handleLogout()"><i class="fas fa-right-from-bracket"></i> Logout</button></div>
        </div>
        <div class="page-content">
            <!-- DASHBOARD -->
            <div class="page active" id="page-dashboard">
                <div class="stats-grid"><div class="stat-card"><div class="stat-icon" style="background:rgba(108,92,231,0.15)">üèõÔ∏è</div><div class="stat-value" id="statClubs">0</div><div class="stat-label">Active Clubs</div></div><div class="stat-card"><div class="stat-icon" style="background:rgba(0,206,201,0.15)">üìÖ</div><div class="stat-value" id="statEvents">0</div><div class="stat-label">Total Events</div></div><div class="stat-card"><div class="stat-icon" style="background:rgba(253,121,168,0.15)">üë•</div><div class="stat-value" id="statStudents">0</div><div class="stat-label">Active Students</div></div><div class="stat-card"><div class="stat-icon" style="background:rgba(0,184,148,0.15)">üèÜ</div><div class="stat-value" id="statCerts">0</div><div class="stat-label">Certificates</div></div></div>
                <div class="section-header"><h2>My Clubs</h2></div>
                <div class="clubs-grid" id="myClubsGrid"><div class="loading"><div class="spinner"></div> Loading...</div></div>
                <div style="margin-top:32px"><div class="section-header"><h2>My Registered Events</h2></div><div class="events-grid" id="myRegisteredEvents"><div class="loading"><div class="spinner"></div> Loading...</div></div></div>
            </div>
            <!-- CLUBS -->
            <div class="page" id="page-clubs">
                <div class="section-header"><h2>Explore Clubs</h2></div>
                <div class="filter-bar" id="clubFilters"><button class="filter-btn active" onclick="filterClubs('all',this)">All</button><button class="filter-btn" onclick="filterClubs('Technology',this)">Technology</button><button class="filter-btn" onclick="filterClubs('Arts & Media',this)">Arts & Media</button><button class="filter-btn" onclick="filterClubs('Music & Dance',this)">Music & Dance</button><button class="filter-btn" onclick="filterClubs('Literary',this)">Literary</button><button class="filter-btn" onclick="filterClubs('Sports',this)">Sports</button><button class="filter-btn" onclick="filterClubs('Social Service',this)">Social Service</button></div>
                <div class="clubs-grid" id="allClubsGrid"><div class="loading"><div class="spinner"></div> Loading...</div></div>
            </div>
            <!-- EVENTS -->
            <div class="page" id="page-events">
                <div class="section-header"><h2>Events</h2></div>
                <div class="admin-section create-event-section" id="createEventSection">
                    <h3>üìù Create Event <span id="createEventClubName" style="color:var(--primary-light)"></span></h3>
                    <div class="form-group"><label>Event Title</label><input type="text" id="evtTitle" placeholder="Event name"></div>
                    <div class="form-group"><label>Description</label><textarea id="evtDesc" placeholder="Event description"></textarea></div>
                    <div class="form-row"><div class="form-group"><label>Date</label><input type="date" id="evtDate"></div><div class="form-group"><label>Venue</label><input type="text" id="evtVenue" placeholder="Location"></div></div>
                    <div class="form-row"><div class="form-group"><label>Start Time</label><input type="time" id="evtStart"></div><div class="form-group"><label>End Time</label><input type="time" id="evtEnd"></div></div>
                    <div class="form-row"><div class="form-group"><label>Max Participants</label><input type="number" id="evtMax" value="100"></div><div class="form-group"><label>Price (‚Çπ)</label><input type="number" id="evtPrice" value="0" step="10"></div></div>
                    <div class="form-group"><label>Event Type</label><select id="evtType"><option value="workshop">Workshop</option><option value="competition">Competition</option><option value="seminar">Seminar</option><option value="social">Social</option><option value="meetup">Meetup</option></select></div>
                    <button class="btn-primary" onclick="createEvent()" style="max-width:200px">Create Event</button>
                </div>
                <div class="filter-bar"><button class="filter-btn active" onclick="filterEvents('all',this)">All</button><button class="filter-btn" onclick="filterEvents('upcoming',this)">Upcoming</button><button class="filter-btn" onclick="filterEvents('completed',this)">Completed</button></div>
                <div class="events-grid" id="allEventsGrid"><div class="loading"><div class="spinner"></div> Loading...</div></div>
            </div>
            <!-- CALENDAR -->
            <div class="page" id="page-calendar">
                <div class="section-header"><h2>üìÖ My Event Calendar</h2></div>
                <div class="calendar-container">
                    <div class="calendar-header-bar"><div class="calendar-nav"><button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button></div><h3 id="calendarMonthYear">January 2025</h3><div class="calendar-nav"><button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button></div></div>
                    <div class="calendar-weekdays"><span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span></div>
                    <div class="calendar-days" id="calendarDays"></div>
                    <div class="calendar-events-panel"><h4 id="calSelectedDate">Select a date to see your events</h4><div id="calEventsList"></div></div>
                </div>
            </div>
            <!-- CHAT -->
            <div class="page" id="page-chat">
                <div class="chat-container">
                    <div class="chat-channels"><div class="chat-channels-header">üí¨ Club Chats</div><div id="channelList"><div class="loading"><div class="spinner"></div></div></div></div>
                    <div class="chat-main">
                        <div class="chat-no-channel" id="chatPlaceholder"><div style="text-align:center"><div style="font-size:48px;margin-bottom:16px">üí¨</div><p>Select a club to start chatting</p></div></div>
                        <div id="chatActive" style="display:none;flex-direction:column;height:100%"><div class="chat-header" id="chatHeaderTitle">Chat</div><div class="chat-messages" id="chatMessages"></div><div class="chat-input-area"><input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendMessage()"><button class="chat-send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button></div></div>
                    </div>
                </div>
            </div>
            <!-- CERTIFICATES -->
            <div class="page" id="page-certificates">
                <div class="section-header"><h2>üèÜ My Certificates</h2></div>
                <div class="verify-box"><h3>üîç Verify a Certificate</h3><p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px">Enter verification code to validate</p><div class="verify-input-group"><input type="text" id="verifyCode" placeholder="Enter verification code"><button class="btn-sm btn-join" onclick="verifyCertificate()" style="flex:none;width:100px">Verify</button></div><div class="verify-result" id="verifyResult"></div></div>
                <div class="certificates-grid" id="certificatesGrid"><div class="loading"><div class="spinner"></div> Loading...</div></div>
            </div>
            <!-- NOTIFICATIONS -->
            <div class="page" id="page-notifications">
                <div class="section-header"><h2>Notifications</h2><button class="btn-sm btn-view" onclick="markAllRead()"><i class="fas fa-check-double"></i> Mark All Read</button></div>
                <div class="notification-list" id="notificationList"><div class="loading"><div class="spinner"></div> Loading...</div></div>
            </div>
            <!-- ADMIN -->
            <div class="page" id="page-admin">
                <div class="section-header"><h2>‚öôÔ∏è Admin Panel ‚Äî <span id="adminClubTitle" style="color:var(--primary-light)">My Club</span></h2></div>
                <div class="admin-club-dashboard" id="adminClubDashboard"></div>
                <div style="margin-bottom:32px"><h3 style="margin-bottom:16px;font-size:18px"><i class="fas fa-user-clock" style="color:var(--warning)"></i> Pending Membership Requests</h3><div class="pending-list" id="pendingMembersList"><div class="loading"><div class="spinner"></div> Loading...</div></div></div>
                <div class="admin-section show" id="adminCreateEventInPanel">
                    <h3 style="margin-bottom:16px;font-size:18px"><i class="fas fa-plus-circle" style="color:var(--success)"></i> Create Event</h3>
                    <div class="create-event-section" style="margin-bottom:0">
                        <div class="form-group"><label>Event Title</label><input type="text" id="adminEvtTitle" placeholder="Event name"></div>
                        <div class="form-group"><label>Description</label><textarea id="adminEvtDesc" placeholder="Description"></textarea></div>
                        <div class="form-row"><div class="form-group"><label>Date</label><input type="date" id="adminEvtDate"></div><div class="form-group"><label>Venue</label><input type="text" id="adminEvtVenue" placeholder="Location"></div></div>
                        <div class="form-row"><div class="form-group"><label>Start Time</label><input type="time" id="adminEvtStart"></div><div class="form-group"><label>End Time</label><input type="time" id="adminEvtEnd"></div></div>
                        <div class="form-row"><div class="form-group"><label>Max Participants</label><input type="number" id="adminEvtMax" value="100"></div><div class="form-group"><label>Price (‚Çπ)</label><input type="number" id="adminEvtPrice" value="0"></div></div>
                        <div class="form-group"><label>Event Type</label><select id="adminEvtType"><option value="workshop">Workshop</option><option value="competition">Competition</option><option value="seminar">Seminar</option><option value="social">Social</option><option value="meetup">Meetup</option></select></div>
                        <button class="btn-primary" onclick="createEventAdmin()" style="max-width:200px">Create Event</button>
                    </div>
                </div>
            </div>
            <!-- PROFILE -->
            <div class="page" id="page-profile">
                <div class="profile-header"><div class="profile-avatar" id="profileAvatar">U</div><div class="profile-details"><h2 id="profileName">User</h2><div class="profile-email" id="profileEmail">user@email.com</div><div class="profile-meta"><span id="profileDept"><i class="fas fa-building"></i> Dept</span><span id="profileYear"><i class="fas fa-graduation-cap"></i> Year</span><span id="profileRole"><i class="fas fa-shield"></i> Role</span></div></div></div>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:32px"><div class="stat-card"><div class="stat-value" id="profileClubCount">0</div><div class="stat-label">Clubs Joined</div></div><div class="stat-card"><div class="stat-value" id="profileEventCount">0</div><div class="stat-label">Events Attended</div></div><div class="stat-card"><div class="stat-value" id="profileCertCount">0</div><div class="stat-label">Certificates</div></div></div>
                <div class="section-header"><h2>Edit Profile</h2></div>
                <div style="max-width:500px"><div class="form-group"><label>Name</label><input type="text" id="editName"></div><div class="form-row"><div class="form-group"><label>Department</label><select id="editDept"><option value="">Select</option><option>CSE</option><option>ECE</option><option>EEE</option><option>ME</option><option>CE</option><option>IT</option><option>MBA</option><option>Other</option></select></div><div class="form-group"><label>Year</label><select id="editYear"><option value="">Select</option><option value="1">1st</option><option value="2">2nd</option><option value="3">3rd</option><option value="4">4th</option></select></div></div><button class="btn-primary" onclick="updateProfile()">Save Changes</button></div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()"><div class="modal" id="modalContent"></div></div>

<script>
const API=window.location.origin;let currentUser=null,authToken=null,allClubs=[],allEvents=[],myRegEvents=[],currentChatClubId=null,chatPoll=null,calDate=new Date(),adminClubName='',adminClubData=null;

document.addEventListener('DOMContentLoaded',()=>{const s=localStorage.getItem('campushub_auth');if(s){const p=JSON.parse(s);authToken=p.token;currentUser=p.user;showApp();}loadClubsForReg();loadLandingStats();});

function authH(){return{'Content-Type':'application/json','Authorization':`Bearer ${authToken}`};}
async function api(ep,opt={}){const r=await fetch(`${API}${ep}`,{...opt,headers:{...authH(),...opt.headers}});const d=await r.json();if(!r.ok){if(r.status===401){handleLogout();throw new Error('Session expired');}throw new Error(d.error||'Error');}return d;}
function toast(m,t='info'){const c=document.getElementById('toastContainer'),e=document.createElement('div');e.className=`toast ${t}`;e.textContent=m;c.appendChild(e);setTimeout(()=>{e.style.opacity='0';setTimeout(()=>e.remove(),300);},3000);}

// LANDING
function showLanding(){document.getElementById('landingPage').style.display='block';document.getElementById('authPage').classList.remove('active');document.getElementById('appContainer').classList.remove('active');}
function showAuthPage(type){document.getElementById('landingPage').style.display='none';document.getElementById('authPage').classList.add('active');document.getElementById('appContainer').classList.remove('active');if(type==='login'){document.getElementById('loginForm').style.display='block';document.getElementById('registerForm').style.display='none';}else{document.getElementById('loginForm').style.display='none';document.getElementById('registerForm').style.display='block';}}
async function loadLandingStats(){try{const r=await fetch(`${API}/api/stats`);const s=await r.json();document.getElementById('lsClubs').textContent=s.activeClubs||12;document.getElementById('lsEvents').textContent=(s.totalEvents||50)+'+';document.getElementById('lsStudents').textContent=(s.activeStudents||1000)+'+';document.getElementById('lsCerts').textContent=(s.certificatesIssued||500)+'+';}catch(e){}}

// OTP
async function sendOTP(){
    const email=document.getElementById('regEmail').value.trim();
    if(!email){toast('Enter email first','error');return;}
    if(!email.includes('@')){toast('Enter a valid email','error');return;}
    const btn=document.getElementById('sendOtpBtn');
    btn.disabled=true;btn.textContent='Sending...';
    try{
        const r=await fetch(`${API}/api/auth/send-otp`,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({email})
        });
        const d=await r.json();
        if(!r.ok) throw new Error(d.error);
        document.getElementById('otpSection').classList.add('show');
        document.getElementById('otpStatus').textContent='‚úâÔ∏è Code sent to '+email;
        document.getElementById('otpStatus').className='otp-status pending';
        toast('Verification code sent! Check your email.','success');
    }catch(e){
        toast(e.message,'error');
    }finally{
        btn.disabled=false;btn.textContent='Send OTP';
    }
}
async function verifyOTP(){const email=document.getElementById('regEmail').value.trim();const otp=document.getElementById('otpInput').value.trim();if(!otp){toast('Enter OTP','error');return;}try{const r=await fetch(`${API}/api/auth/verify-otp`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,otp})});const d=await r.json();if(!r.ok)throw new Error(d.error);document.getElementById('emailVerified').value='true';document.getElementById('otpStatus').textContent='‚úÖ Email verified!';document.getElementById('otpStatus').className='otp-status verified';document.getElementById('otpSection').classList.remove('show');toast('Email verified!','success');}catch(e){toast(e.message,'error');}}

// AUTH
async function loadClubsForReg(){try{const r=await fetch(`${API}/api/auth/clubs-list`);const clubs=await r.json();const s=document.getElementById('regClub');s.innerHTML='<option value="">Select your club</option>'+clubs.map(c=>`<option value="${c.id}">${c.icon||'üèõÔ∏è'} ${c.name}</option>`).join('');}catch(e){}}
async function handleLogin(){const email=document.getElementById('loginEmail').value.trim(),pw=document.getElementById('loginPassword').value,err=document.getElementById('loginError'),btn=document.getElementById('loginBtn');if(!email||!pw){err.textContent='Fill all fields.';err.classList.add('show');return;}btn.disabled=true;btn.textContent='Signing in...';err.classList.remove('show');try{const r=await fetch(`${API}/api/auth/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password:pw})});const d=await r.json();if(!r.ok)throw new Error(d.error);authToken=d.token;currentUser=d.user;localStorage.setItem('campushub_auth',JSON.stringify({token:authToken,user:currentUser}));toast('Welcome back, '+currentUser.name+'!','success');showApp();}catch(e){err.textContent=e.message;err.classList.add('show');}finally{btn.disabled=false;btn.textContent='Sign In';}}
async function handleRegister(){const name=document.getElementById('regName').value.trim(),email=document.getElementById('regEmail').value.trim(),pw=document.getElementById('regPassword').value,dept=document.getElementById('regDept').value,yr=document.getElementById('regYear').value,role=document.getElementById('regRole').value,club_id=document.getElementById('regClub').value,verified=document.getElementById('emailVerified').value,err=document.getElementById('registerError'),btn=document.getElementById('registerBtn');if(!name||!email||!pw){err.textContent='Fill required fields.';err.classList.add('show');return;}if(pw.length<6){err.textContent='Password 6+ chars.';err.classList.add('show');return;}if(verified!=='true'){err.textContent='Please verify your email first.';err.classList.add('show');return;}if(role==='admin'&&!club_id){err.textContent='Select your club.';err.classList.add('show');return;}btn.disabled=true;btn.textContent='Creating...';err.classList.remove('show');try{const r=await fetch(`${API}/api/auth/register`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password:pw,name,department:dept,year:yr?parseInt(yr):null,role,club_id:role==='admin'?club_id:null})});const d=await r.json();if(!r.ok)throw new Error(d.error);authToken=d.token;currentUser=d.user;localStorage.setItem('campushub_auth',JSON.stringify({token:authToken,user:currentUser}));toast('Account created!','success');showApp();}catch(e){err.textContent=e.message;err.classList.add('show');}finally{btn.disabled=false;btn.textContent='Create Account';}}
function selectRole(r,el){document.getElementById('regRole').value=r;document.querySelectorAll('.role-option').forEach(o=>o.classList.remove('active'));el.classList.add('active');document.getElementById('clubSelectGroup').classList.toggle('show',r==='admin');}
function handleLogout(){authToken=null;currentUser=null;localStorage.removeItem('campushub_auth');if(chatPoll)clearInterval(chatPoll);document.getElementById('appContainer').classList.remove('active');showLanding();toast('Logged out','info');}

// APP
async function showApp(){document.getElementById('landingPage').style.display='none';document.getElementById('authPage').classList.remove('active');document.getElementById('appContainer').classList.add('active');const i=currentUser.name.split(' ').map(n=>n[0]).join('').toUpperCase();document.getElementById('sidebarAvatar').textContent=i;document.getElementById('sidebarName').textContent=currentUser.name;document.getElementById('sidebarEmail').textContent=currentUser.email;const isA=currentUser.role==='admin';document.getElementById('sidebarRole').textContent=isA?'Club Admin Portal':'Student Portal';document.getElementById('adminNav').classList.toggle('show',isA);document.getElementById('createEventSection').classList.toggle('show',isA);if(isA&&currentUser.admin_club_id){try{const c=await api(`/api/clubs/${currentUser.admin_club_id}`);adminClubName=c.name;adminClubData=c;document.getElementById('sidebarClubName').textContent=`${c.icon||'üèõÔ∏è'} ${c.name}`;document.getElementById('sidebarClubName').style.display='block';document.getElementById('createEventClubName').textContent=`for ${c.name}`;}catch(e){}}navigateTo('dashboard');}

// NAV
function navigateTo(p){document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));const nav=document.querySelector(`.nav-item[data-page="${p}"]`);if(nav)nav.classList.add('active');document.querySelectorAll('.page').forEach(pg=>pg.classList.remove('active'));document.getElementById(`page-${p}`).classList.add('active');const t={dashboard:'Dashboard',clubs:'Explore Clubs',events:'Events',calendar:'My Calendar',chat:'Chat',certificates:'Certificates',notifications:'Notifications',admin:'Admin Panel',profile:'Profile'};document.getElementById('pageTitle').textContent=t[p]||p;document.getElementById('sidebar').classList.remove('open');switch(p){case'dashboard':loadDashboard();break;case'clubs':loadAllClubs();break;case'events':loadAllEvents();break;case'calendar':loadCalendar();break;case'chat':loadChatChannels();break;case'certificates':loadCertificates();break;case'notifications':loadNotifications();break;case'admin':loadAdminPanel();break;case'profile':loadProfile();break;}}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');}

// DASHBOARD
async function loadDashboard(){try{const s=await api('/api/stats');document.getElementById('statClubs').textContent=s.activeClubs;document.getElementById('statEvents').textContent=s.totalEvents;document.getElementById('statStudents').textContent=s.activeStudents;document.getElementById('statCerts').textContent=s.certificatesIssued;}catch(e){}
try{const m=await api('/api/memberships/my');const g=document.getElementById('myClubsGrid');const a=m.filter(x=>x.status==='approved');if(!a.length)g.innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üèõÔ∏è</div><h3>No clubs yet</h3><button class="btn-sm btn-join" style="margin-top:12px" onclick="navigateTo(\'clubs\')">Browse Clubs</button></div>';else g.innerHTML=a.map(x=>renderClubCard(x.clubs,'approved')).join('');}catch(e){document.getElementById('myClubsGrid').innerHTML='<div class="empty-state"><p>Error loading clubs</p></div>';}
try{myRegEvents=await api('/api/events/my-registrations');const g=document.getElementById('myRegisteredEvents');if(!myRegEvents.length)g.innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üìÖ</div><h3>No registered events</h3><button class="btn-sm btn-join" style="margin-top:12px" onclick="navigateTo(\'events\')">Browse Events</button></div>';else g.innerHTML=myRegEvents.map(e=>renderMyEventCard(e)).join('');}catch(e){document.getElementById('myRegisteredEvents').innerHTML='<div class="empty-state"><p>Error loading events</p></div>';}
loadNotifCount();}

function renderMyEventCard(ev){const c=(ev.color||'#6C5CE7,#A29BFE').split(','),cn=ev.clubs?ev.clubs.name:'Unknown',dt=new Date(ev.event_date).toLocaleDateString('en-IN',{weekday:'short',month:'short',day:'numeric'}),sl=ev.registration_status==='attended'?'Attended':'Registered',sc=ev.registration_status==='attended'?'attended':'registered';return `<div class="event-card" onclick="showEventDetail('${ev.id}')"><div class="event-card-banner" style="background:linear-gradient(135deg,${c[0]},${c[1]||c[0]})"><span class="event-icon">${ev.icon||'üìÖ'}</span><span class="event-club">${cn}</span></div><div class="event-card-body"><h3>${ev.title}</h3><div class="event-detail"><i class="fas fa-calendar"></i> ${dt}</div><div class="event-detail"><i class="fas fa-clock"></i> ${ev.start_time} - ${ev.end_time}</div><div class="event-detail"><i class="fas fa-location-dot"></i> ${ev.venue||'TBA'}</div></div><div class="event-card-footer"><span class="event-reg-status ${sc}">‚úÖ ${sl}</span><span class="event-price">${ev.price>0?'‚Çπ'+ev.price:'Free'}</span></div></div>`;}

// CLUBS
async function loadAllClubs(cat='all'){const g=document.getElementById('allClubsGrid');g.innerHTML='<div class="loading"><div class="spinner"></div> Loading...</div>';try{const p=cat!=='all'?`?category=${cat}`:'';allClubs=await api(`/api/clubs${p}`);let my=[];try{my=await api('/api/memberships/my');}catch(e){}const map={};my.forEach(m=>{map[m.clubs.id]=m.status;});if(!allClubs.length)g.innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üîç</div><h3>No clubs found</h3></div>';else g.innerHTML=allClubs.map(c=>renderClubCard(c,map[c.id])).join('');}catch(e){g.innerHTML='<div class="empty-state"><p>Error</p></div>';}}
function renderClubCard(cl,st){const c=(cl.color||'#6C5CE7,#A29BFE').split(',');let b='';if(st==='approved')b=`<button class="btn-sm btn-joined" disabled>‚úÖ Joined</button><button class="btn-sm btn-leave" onclick="event.stopPropagation();leaveClub('${cl.id}')">Leave</button>`;else if(st==='pending')b=`<button class="btn-sm btn-pending" disabled>‚è≥ Pending</button>`;else b=`<button class="btn-sm btn-join" onclick="event.stopPropagation();joinClub('${cl.id}')">Join Club</button>`;return `<div class="club-card"><div class="club-card-banner" style="background:linear-gradient(135deg,${c[0]},${c[1]||c[0]})">${cl.icon||'üèõÔ∏è'}</div><div class="club-card-body"><span class="badge-category" style="background:${c[0]}22;color:${c[0]}">${cl.category}</span><h3>${cl.name}</h3><p>${cl.description||'No description'}</p><div class="club-card-meta"><span class="members"><i class="fas fa-users"></i> ${cl.member_count||0}</span><span class="rating"><i class="fas fa-star"></i> ${cl.rating||'0.0'}</span></div></div><div class="club-card-actions">${b}</div></div>`;}
function filterClubs(c,b){document.querySelectorAll('#clubFilters .filter-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');loadAllClubs(c);}
async function joinClub(id){try{await api(`/api/memberships/join/${id}`,{method:'POST'});toast('Request sent!','success');loadAllClubs();}catch(e){toast(e.message,'error');}}
async function leaveClub(id){if(!confirm('Leave?'))return;try{await api(`/api/memberships/leave/${id}`,{method:'DELETE'});toast('Left club','info');loadAllClubs();loadDashboard();}catch(e){toast(e.message,'error');}}

// EVENTS
async function loadAllEvents(f='all'){const g=document.getElementById('allEventsGrid');g.innerHTML='<div class="loading"><div class="spinner"></div> Loading...</div>';try{let p='';if(f==='upcoming')p='?upcoming=true';else if(f==='completed')p='?status=completed';allEvents=await api(`/api/events${p}`);if(!allEvents.length)g.innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üìÖ</div><h3>No events</h3></div>';else g.innerHTML=allEvents.map(e=>renderEventCard(e)).join('');}catch(e){g.innerHTML='<div class="empty-state"><p>Error</p></div>';}}
function renderEventCard(ev){const c=(ev.color||'#6C5CE7,#A29BFE').split(','),cn=ev.clubs?ev.clubs.name:'Unknown',dt=new Date(ev.event_date).toLocaleDateString('en-IN',{weekday:'short',month:'short',day:'numeric'}),sp=ev.max_participants-(ev.registered_count||0);return `<div class="event-card" onclick="showEventDetail('${ev.id}')"><div class="event-card-banner" style="background:linear-gradient(135deg,${c[0]},${c[1]||c[0]})"><span class="event-icon">${ev.icon||'üìÖ'}</span><span class="event-club">${cn}</span></div><div class="event-card-body"><h3>${ev.title}</h3><div class="event-detail"><i class="fas fa-calendar"></i> ${dt}</div><div class="event-detail"><i class="fas fa-clock"></i> ${ev.start_time} - ${ev.end_time}</div><div class="event-detail"><i class="fas fa-location-dot"></i> ${ev.venue||'TBA'}</div></div><div class="event-card-footer"><span class="event-spots">${sp>0?sp+' spots':'Full'}</span><span class="event-price">${ev.price>0?'‚Çπ'+ev.price:'Free'}</span><button class="btn-sm btn-join" onclick="event.stopPropagation();registerEvent('${ev.id}')" ${ev.is_full?'disabled style="opacity:.5"':''}>${ev.is_full?'Full':'Register'}</button></div></div>`;}
function filterEvents(f,b){document.querySelectorAll('#page-events .filter-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');loadAllEvents(f);}
async function registerEvent(id){try{await api(`/api/events/${id}/register`,{method:'POST'});toast('Registered!','success');loadAllEvents();loadDashboard();}catch(e){toast(e.message,'error');}}

async function showEventDetail(id){try{const ev=await api(`/api/events/${id}`);const c=(ev.color||'#6C5CE7,#A29BFE').split(','),cn=ev.clubs?ev.clubs.name:'',dt=new Date(ev.event_date).toLocaleDateString('en-IN',{weekday:'long',month:'long',day:'numeric',year:'numeric'});openModal(`<button class="modal-close" onclick="closeModal()">‚úï</button><div style="text-align:center;padding:20px 0;background:linear-gradient(135deg,${c[0]},${c[1]||c[0]});border-radius:12px;margin-bottom:20px"><span style="font-size:48px">${ev.icon||'üìÖ'}</span><h2 style="margin-top:8px">${ev.title}</h2><p style="color:rgba(255,255,255,0.8);font-size:13px">${cn}</p></div><p style="color:var(--text-secondary);line-height:1.6;margin-bottom:20px">${ev.description||'No description'}</p><div style="display:grid;gap:8px;margin-bottom:20px"><div class="event-detail"><i class="fas fa-calendar"></i> ${dt}</div><div class="event-detail"><i class="fas fa-clock"></i> ${ev.start_time} - ${ev.end_time}</div><div class="event-detail"><i class="fas fa-location-dot"></i> ${ev.venue||'TBA'}</div><div class="event-detail"><i class="fas fa-users"></i> ${ev.registered_count||0}/${ev.max_participants} registered</div><div class="event-detail"><i class="fas fa-tag"></i> ${ev.event_type}</div><div class="event-detail"><i class="fas fa-ticket"></i> ${ev.price>0?'‚Çπ'+ev.price:'Free'}</div></div>${ev.userRegistration?'<button class="btn-primary" disabled style="background:var(--gradient-success)">‚úÖ Already Registered</button>':`<button class="btn-primary" onclick="registerEvent('${ev.id}');closeModal()" ${ev.is_full?'disabled':''}>${ev.is_full?'Event Full':'Register Now'}</button>`}`);}catch(e){toast('Error loading event','error');}}

async function createEvent(){const t=document.getElementById('evtTitle').value.trim(),d=document.getElementById('evtDesc').value.trim(),dt=document.getElementById('evtDate').value,s=document.getElementById('evtStart').value,en=document.getElementById('evtEnd').value,v=document.getElementById('evtVenue').value.trim(),mx=parseInt(document.getElementById('evtMax').value)||100,pr=parseFloat(document.getElementById('evtPrice').value)||0,tp=document.getElementById('evtType').value,cid=currentUser.admin_club_id;if(!t||!dt||!s||!en){toast('Fill required fields','error');return;}if(!cid){toast('No club assigned','error');return;}try{await api('/api/events',{method:'POST',body:JSON.stringify({title:t,description:d,club_id:cid,event_date:dt,start_time:s,end_time:en,venue:v,max_participants:mx,price:pr,event_type:tp})});toast('Event created!','success');['evtTitle','evtDesc','evtDate','evtStart','evtEnd','evtVenue'].forEach(x=>document.getElementById(x).value='');loadAllEvents();}catch(e){toast(e.message,'error');}}
async function createEventAdmin(){const t=document.getElementById('adminEvtTitle').value.trim(),d=document.getElementById('adminEvtDesc').value.trim(),dt=document.getElementById('adminEvtDate').value,s=document.getElementById('adminEvtStart').value,en=document.getElementById('adminEvtEnd').value,v=document.getElementById('adminEvtVenue').value.trim(),mx=parseInt(document.getElementById('adminEvtMax').value)||100,pr=parseFloat(document.getElementById('adminEvtPrice').value)||0,tp=document.getElementById('adminEvtType').value,cid=currentUser.admin_club_id;if(!t||!dt||!s||!en){toast('Fill required fields','error');return;}if(!cid){toast('No club assigned','error');return;}try{await api('/api/events',{method:'POST',body:JSON.stringify({title:t,description:d,club_id:cid,event_date:dt,start_time:s,end_time:en,venue:v,max_participants:mx,price:pr,event_type:tp})});toast('Event created!','success');['adminEvtTitle','adminEvtDesc','adminEvtDate','adminEvtStart','adminEvtEnd','adminEvtVenue'].forEach(x=>document.getElementById(x).value='');loadAdminPanel();}catch(e){toast(e.message,'error');}}

// CALENDAR
async function loadCalendar(){try{myRegEvents=await api('/api/events/my-registrations');}catch(e){myRegEvents=[];}renderCalendar();}
function renderCalendar(){const y=calDate.getFullYear(),m=calDate.getMonth();const names=['January','February','March','April','May','June','July','August','September','October','November','December'];document.getElementById('calendarMonthYear').textContent=`${names[m]} ${y}`;const fd=new Date(y,m,1).getDay(),dim=new Date(y,m+1,0).getDate(),dip=new Date(y,m,0).getDate(),today=new Date();const ed={};myRegEvents.forEach(e=>{const d=e.event_date;if(!ed[d])ed[d]=[];ed[d].push(e);});let h='';for(let i=fd-1;i>=0;i--)h+=`<div class="calendar-day other-month">${dip-i}</div>`;for(let d=1;d<=dim;d++){const ds=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;const it=today.getFullYear()===y&&today.getMonth()===m&&today.getDate()===d;const he=ed[ds];const cls=['calendar-day'];if(it)cls.push('today');if(he)cls.push('has-event');h+=`<div class="${cls.join(' ')}" onclick="selectCalDate('${ds}',this)">${d}</div>`;}const tot=fd+dim;const rem=tot%7===0?0:7-(tot%7);for(let i=1;i<=rem;i++)h+=`<div class="calendar-day other-month">${i}</div>`;document.getElementById('calendarDays').innerHTML=h;document.getElementById('calSelectedDate').textContent='Select a date to see your events';document.getElementById('calEventsList').innerHTML='';}
function changeMonth(d){calDate.setMonth(calDate.getMonth()+d);renderCalendar();}
function selectCalDate(ds,el){document.querySelectorAll('.calendar-day').forEach(d=>d.classList.remove('selected'));el.classList.add('selected');const dt=new Date(ds+'T00:00:00');const fmt=dt.toLocaleDateString('en-IN',{weekday:'long',month:'long',day:'numeric',year:'numeric'});document.getElementById('calSelectedDate').textContent=`Your events on ${fmt}`;const de=myRegEvents.filter(e=>e.event_date===ds);const l=document.getElementById('calEventsList');if(!de.length)l.innerHTML='<p style="color:var(--text-muted);font-size:13px">No registered events on this date</p>';else l.innerHTML=de.map(e=>{const c=(e.color||'#6C5CE7,#A29BFE').split(',');return `<div class="cal-event-item"><div class="cal-event-dot" style="background:${c[0]}"></div><div class="cal-event-info"><div class="cal-event-title">${e.icon||'üìÖ'} ${e.title}</div><div class="cal-event-time">${e.start_time} - ${e.end_time} ‚Ä¢ ${e.venue||'TBA'}</div></div></div>`;}).join('');}

// CHAT
async function loadChatChannels(){const l=document.getElementById('channelList');try{const ch=await api('/api/chat');if(!ch.length)l.innerHTML='<div style="padding:20px;text-align:center;color:var(--text-muted);font-size:13px">Join a club to chat</div>';else l.innerHTML=ch.map(c=>{const cl=(c.color||'#6C5CE7,#A29BFE').split(',');const la=c.last_message?`${c.last_message.sender}: ${c.last_message.text}`.substring(0,30)+'...':'No messages';return `<div class="channel-item ${currentChatClubId===c.id?'active':''}" onclick="openChat('${c.id}','${c.name.replace(/'/g,"\\'")}','${c.icon||'üí¨'}')"><div class="channel-icon" style="background:linear-gradient(135deg,${cl[0]},${cl[1]||cl[0]})">${c.icon||'üí¨'}</div><div class="channel-info"><div class="channel-name">${c.name}</div><div class="channel-last-msg">${la}</div></div></div>`;}).join('');}catch(e){l.innerHTML='<div style="padding:20px;color:var(--text-muted)">Error</div>';}}
async function openChat(cid,cn,ic){currentChatClubId=cid;document.getElementById('chatPlaceholder').style.display='none';document.getElementById('chatActive').style.display='flex';document.getElementById('chatHeaderTitle').textContent=`${ic} ${cn}`;document.querySelectorAll('.channel-item').forEach(c=>c.classList.remove('active'));if(event&&event.currentTarget)event.currentTarget.classList.add('active');await loadMsgs();if(chatPoll)clearInterval(chatPoll);chatPoll=setInterval(loadMsgs,3000);}
async function loadMsgs(){if(!currentChatClubId)return;try{const msgs=await api(`/api/chat/${currentChatClubId}/messages`);const c=document.getElementById('chatMessages');c.innerHTML=msgs.map(m=>{const own=m.sender_id===currentUser.id;const sn=m.users?m.users.name:'Unknown';const ini=sn.split(' ').map(n=>n[0]).join('').toUpperCase();const tm=new Date(m.sent_at).toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});return `<div class="chat-msg ${own?'own':''}"><div class="chat-msg-avatar">${ini}</div><div class="chat-msg-bubble"><div class="chat-msg-sender">${own?'You':sn}</div><div class="chat-msg-text">${escHtml(m.message)}</div><div class="chat-msg-time">${tm}</div></div></div>`;}).join('');c.scrollTop=c.scrollHeight;}catch(e){}}
async function sendMessage(){const inp=document.getElementById('chatInput');const m=inp.value.trim();if(!m||!currentChatClubId)return;inp.value='';try{await api(`/api/chat/${currentChatClubId}/messages`,{method:'POST',body:JSON.stringify({message:m})});await loadMsgs();}catch(e){toast(e.message,'error');}}

// CERTIFICATES
async function loadCertificates(){const g=document.getElementById('certificatesGrid');g.innerHTML='<div class="loading"><div class="spinner"></div> Loading...</div>';try{const certs=await api('/api/certificates');if(!certs||!certs.length)g.innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üèÜ</div><h3>No certificates yet</h3><p>Attend events to earn certificates!</p></div>';else g.innerHTML=certs.map(c=>{const dt=new Date(c.issued_at).toLocaleDateString('en-IN',{month:'short',day:'numeric',year:'numeric'});const et=c.events?c.events.title:'Event';const cn=c.events&&c.events.clubs?c.events.clubs.name:'';return `<div class="cert-card"><div class="cert-card-top"><div class="cert-icon">üèÜ</div><h3>${et}</h3><div class="cert-type">${c.certificate_type||'Participation'}</div></div><div class="cert-card-body"><div class="cert-detail"><span class="cert-label">Club</span><span class="cert-value">${cn}</span></div><div class="cert-detail"><span class="cert-label">Issued</span><span class="cert-value">${dt}</span></div><div class="cert-detail"><span class="cert-label">Code</span><span class="cert-value" style="color:var(--primary-light)">${c.verification_code||'N/A'}</span></div></div><div class="cert-card-actions"><button class="btn-download" onclick="toast('Download coming soon!','info')"><i class="fas fa-download"></i> Download</button></div></div>`;}).join('');}catch(e){g.innerHTML='<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üèÜ</div><h3>No certificates yet</h3></div>';}}
async function verifyCertificate(){const code=document.getElementById('verifyCode').value.trim(),r=document.getElementById('verifyResult');if(!code){toast('Enter code','error');return;}try{const d=await api(`/api/certificates/verify/${code}`);r.className='verify-result show valid';r.innerHTML=`<p><strong>‚úÖ Valid Certificate</strong></p><p>Name: ${d.user_name}</p><p>Event: ${d.event_title}</p><p>Issued: ${d.issued_at?new Date(d.issued_at).toLocaleDateString():'N/A'}</p>`;}catch(e){r.className='verify-result show invalid';r.innerHTML='<p><strong>‚ùå Invalid Code</strong></p>';}}

// NOTIFICATIONS
async function loadNotifications(){const l=document.getElementById('notificationList');try{const d=await api('/api/notifications');const n=d.notifications||[];updateNBadges(d.unread_count||0);if(!n.length)l.innerHTML='<div class="empty-state"><div class="empty-icon">üîî</div><h3>No notifications</h3></div>';else l.innerHTML=n.map(x=>{const tm=timeAgo(x.created_at);const isApproval=x.type==='membership_request';return `<div class="notification-item ${x.is_read?'':'unread'}" onclick="handleNotifClick('${x.id}','${x.type}',this)"><span class="notif-icon">${x.icon||'üîî'}</span><div class="notif-content"><div class="notif-title">${x.title}</div><div class="notif-msg">${x.message||''}</div><div class="notif-time">${tm}</div></div>${isApproval?'<span style="font-size:11px;color:var(--primary-light);cursor:pointer">‚Üí Review</span>':''}</div>`;}).join('');}catch(e){l.innerHTML='<div class="empty-state"><p>Error</p></div>';}}
async function handleNotifClick(id,type,el){await markRead(id,el);if(type==='membership_request')navigateTo('admin');}
async function loadNotifCount(){try{const d=await api('/api/notifications?unread_only=true');updateNBadges(d.unread_count||0);}catch(e){}}
function updateNBadges(c){const n=document.getElementById('navNotifBadge'),t=document.getElementById('topNotifBadge');if(c>0){n.textContent=c;n.style.display='block';t.textContent=c;t.style.display='flex';}else{n.style.display='none';t.style.display='none';}}
async function markRead(id,el){try{await api(`/api/notifications/${id}/read`,{method:'PATCH'});if(el)el.classList.remove('unread');loadNotifCount();}catch(e){}}
async function markAllRead(){try{await api('/api/notifications/read-all',{method:'PATCH'});toast('All read','success');loadNotifications();}catch(e){toast(e.message,'error');}}

// ADMIN
async function loadAdminPanel(){if(currentUser.role!=='admin'){document.getElementById('page-admin').innerHTML='<div class="empty-state"><div class="empty-icon">üîí</div><h3>Access Denied</h3></div>';return;}const cid=currentUser.admin_club_id;if(!cid){document.getElementById('adminClubDashboard').innerHTML='<div class="empty-state"><div class="empty-icon">‚ö†Ô∏è</div><h3>No club assigned</h3></div>';return;}
document.getElementById('adminClubTitle').textContent=adminClubName||'My Club';
// Club dashboard
try{const club=await api(`/api/clubs/${cid}`);const evts=await api(`/api/events?club_id=${cid}`);const dash=document.getElementById('adminClubDashboard');
dash.innerHTML=`<div class="admin-info-card"><h4>${club.icon||'üèõÔ∏è'} Club Overview</h4><div class="cert-detail"><span class="cert-label">Members</span><span class="cert-value">${club.memberCount||club.member_count||0}</span></div><div class="cert-detail"><span class="cert-label">Rating</span><span class="cert-value">‚≠ê ${club.rating||'0.0'}</span></div><div class="cert-detail"><span class="cert-label">Category</span><span class="cert-value">${club.category}</span></div><div class="cert-detail"><span class="cert-label">Status</span><span class="cert-value" style="color:var(--success)">${club.status}</span></div></div>
<div class="admin-info-card"><h4>üìÖ Club Events (${evts.length})</h4>${evts.length?evts.slice(0,5).map(e=>`<div class="admin-member-item"><div class="admin-member-avatar" style="background:var(--gradient-success)">${e.icon||'üìÖ'}</div><div style="flex:1"><div style="font-weight:600">${e.title}</div><div style="font-size:11px;color:var(--text-muted)">${new Date(e.event_date).toLocaleDateString()} ‚Ä¢ ${e.registered_count||0} registered</div></div></div>`).join(''):'<p style="color:var(--text-muted);font-size:13px">No events yet</p>'}</div>
<div class="admin-info-card"><h4>üë• Members</h4>${(club.members||[]).length?(club.members||[]).slice(0,8).map(m=>{const u=m.users||{};const ini=(u.name||'U').split(' ').map(n=>n[0]).join('').toUpperCase();return `<div class="admin-member-item"><div class="admin-member-avatar">${ini}</div><div style="flex:1"><div style="font-weight:600">${u.name||'Unknown'}</div><div style="font-size:11px;color:var(--text-muted)">${m.role} ‚Ä¢ ${u.department||''}</div></div></div>`;}).join(''):'<p style="color:var(--text-muted);font-size:13px">No members</p>'}</div>`;}catch(e){document.getElementById('adminClubDashboard').innerHTML='';}

// Pending requests
const ml=document.getElementById('pendingMembersList');try{const pending=await api(`/api/memberships/pending/${cid}`);if(!pending.length)ml.innerHTML='<div class="empty-state"><div class="empty-icon">‚úÖ</div><h3>No pending requests</h3></div>';else ml.innerHTML=pending.map(p=>{const u=p.users||{};const ini=(u.name||'U').split(' ').map(n=>n[0]).join('').toUpperCase();return `<div class="pending-item" id="pending-${p.id}"><div class="pending-info"><div class="pending-avatar">${ini}</div><div><div class="pending-name">${u.name||'Unknown'}</div><div class="pending-detail">${u.email||''} ‚Ä¢ ${u.department||'N/A'}</div></div></div><div class="pending-actions"><button class="btn-approve" onclick="handleMembership('${p.id}','approved')">‚úÖ Approve</button><button class="btn-reject" onclick="handleMembership('${p.id}','rejected')">‚ùå Reject</button></div></div>`;}).join('');}catch(e){ml.innerHTML='<div class="empty-state"><p>Error</p></div>';}}
async function handleMembership(id,st){try{await api(`/api/memberships/${id}/approve`,{method:'PATCH',body:JSON.stringify({status:st})});toast(`Membership ${st}!`,st==='approved'?'success':'info');document.getElementById(`pending-${id}`).remove();}catch(e){toast(e.message,'error');}}

// PROFILE
async function loadProfile(){try{const u=await api('/api/auth/me');currentUser={...currentUser,...u};const ini=u.name.split(' ').map(n=>n[0]).join('').toUpperCase();document.getElementById('profileAvatar').textContent=ini;document.getElementById('profileName').textContent=u.name;document.getElementById('profileEmail').textContent=u.email;document.getElementById('profileDept').innerHTML=`<i class="fas fa-building"></i> ${u.department||'Not set'}`;document.getElementById('profileYear').innerHTML=`<i class="fas fa-graduation-cap"></i> ${u.year?'Year '+u.year:'Not set'}`;document.getElementById('profileRole').innerHTML=`<i class="fas fa-shield"></i> ${u.role==='admin'?'Club Admin':'Student'}`;document.getElementById('profileClubCount').textContent=(u.clubs||[]).length;document.getElementById('profileEventCount').textContent=u.eventsAttended||0;document.getElementById('profileCertCount').textContent=u.certificates||0;document.getElementById('editName').value=u.name||'';document.getElementById('editDept').value=u.department||'';document.getElementById('editYear').value=u.year||'';}catch(e){toast('Error','error');}}
async function updateProfile(){try{const d=await api('/api/auth/profile',{method:'PUT',body:JSON.stringify({name:document.getElementById('editName').value,department:document.getElementById('editDept').value,year:parseInt(document.getElementById('editYear').value)||null})});currentUser={...currentUser,...d.user};localStorage.setItem('campushub_auth',JSON.stringify({token:authToken,user:currentUser}));const ini=currentUser.name.split(' ').map(n=>n[0]).join('').toUpperCase();document.getElementById('sidebarAvatar').textContent=ini;document.getElementById('sidebarName').textContent=currentUser.name;toast('Updated!','success');loadProfile();}catch(e){toast(e.message,'error');}}

// SEARCH
async function handleGlobalSearch(ev){if(ev.key!=='Enter')return;const q=ev.target.value.trim();if(!q)return;navigateTo('clubs');const g=document.getElementById('allClubsGrid');g.innerHTML='<div class="loading"><div class="spinner"></div> Searching...</div>';try{const clubs=await api(`/api/clubs?search=${encodeURIComponent(q)}`);let my=[];try{my=await api('/api/memberships/my');}catch(e){}const map={};my.forEach(m=>{map[m.clubs.id]=m.status;});if(!clubs.length)g.innerHTML=`<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üîç</div><h3>No results for "${q}"</h3></div>`;else g.innerHTML=clubs.map(c=>renderClubCard(c,map[c.id])).join('');}catch(e){g.innerHTML='<div class="empty-state"><p>Error</p></div>';}}

// UTILS
function openModal(c){document.getElementById('modalContent').innerHTML=c;document.getElementById('modalOverlay').classList.add('active');}
function closeModal(){document.getElementById('modalOverlay').classList.remove('active');}
function escHtml(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}
function timeAgo(d){const s=Math.floor((new Date()-new Date(d))/1000);if(s<60)return'just now';if(s<3600)return Math.floor(s/60)+'m ago';if(s<86400)return Math.floor(s/3600)+'h ago';if(s<604800)return Math.floor(s/86400)+'d ago';return new Date(d).toLocaleDateString();}
</script>
</body>
</html>